<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>موقع القرآن التفاعلي</title>
  <style>
    body { font-family: 'Segoe UI', Tahoma, sans-serif; margin: 0; padding: 0; background: #f9f9f9; color: #333; }
    header, footer { background: #004d40; color: white; padding: 1rem; text-align: center; }
    main { padding: 1rem; max-width: 800px; margin: auto; }
    .controls a { margin: 0 .5rem; color: #004d40; text-decoration: none; }
    select, .clock { width: 100%; margin: .5rem 0; padding: .5rem; font-size: 1rem; }
    .verses { margin-top: 1rem; }
    .verse { padding: .5rem; border-bottom: 1px solid #ddd; }
    .rating { display: flex; gap: .2rem; }
    .star { font-size: 1.5rem; cursor: pointer; }
    .active { color: gold; }
    .audio-controls { display: flex; align-items: center; gap: .5rem; margin-top: .5rem; }
    .progress-bar { flex: 1; height: 5px; background: #ddd; border-radius: 2px; overflow: hidden; cursor: pointer; }
    .progress { height: 100%; background: #004d40; width: 0%; }
    .btn-open-prayer { width: 100%; padding: .7rem; background: #004d40; color: white; border: none; cursor: pointer; font-size: 1rem; margin-top: 1rem; }
    @media (max-width: 600px) { main { padding: .5rem; } }
  </style>
</head>
<body>
  <header>
    <h1>موقع القرآن التفاعلي</h1>
    <div class="clock" id="clock"></div>
  </header>
  <main>
    <label for="surahSelect">اختر السورة:</label>
    <select id="surahSelect"></select>
    <div class="rating" id="rating"></div>

    <div class="audio-controls">
      <button id="backward">⏪</button>
      <button id="playPause">▶️</button>
      <button id="forward">⏩</button>
      <div class="progress-bar" id="progressBar"><div class="progress" id="progress"></div></div>
      <span id="timeDisplay">00:00 / 00:00</span>
    </div>

    <div class="verses" id="verses"></div>

    <button class="btn-open-prayer" onclick="window.open('https://timesprayer.today/', '_blank')">
      عرض مواقيت الصلاة مباشرة
    </button>

    <div class="controls">
      <a href="https://t.me/HNR55" target="_blank">راسلني على تليجرام</a>
      <a href="https://www.amazon.com/T3-develper-Car-Fury/dp/B0DWY3QHWF" target="_blank">تحميل CarFury</a>
      <a href="https://t.me/Developer160" target="_blank">قناة المطورين</a>
      <a href="https://t.me/+LM2b9cRHxmA2YmU8" target="_blank">قناة CarFury</a>
    </div>
  </main>
  <footer>&copy; 2025 موقع القرآن التفاعلي</footer>

  <script>
    const surahSelect = document.getElementById('surahSelect');
    const versesDiv = document.getElementById('verses');
    const ratingDiv = document.getElementById('rating');
    const clockEl = document.getElementById('clock');
    const playPauseBtn = document.getElementById('playPause');
    const backwardBtn = document.getElementById('backward');
    const forwardBtn = document.getElementById('forward');
    const progressBar = document.getElementById('progressBar');
    const progress = document.getElementById('progress');
    const timeDisplay = document.getElementById('timeDisplay');

    let audio = new Audio();
    let ayahAudios = [];
    let currentAyah = 0;

    // Clock
    function updateClock() {
      const now = new Date();
      let h = now.getHours();
      const m = now.getMinutes().toString().padStart(2, '0');
      const ampm = h >= 12 ? 'م' : 'ص';
      h = h % 12 || 12;
      clockEl.textContent = `${h}:${m} ${ampm}`;
    }
    setInterval(updateClock, 1000); updateClock();

    // Surah list
    async function loadSurahList() {
      const res = await fetch('https://api.alquran.cloud/v1/surah');
      const data = await res.json();
      data.data.forEach(s => {
        const opt = document.createElement('option');
        opt.value = s.number;
        opt.text = s.englishName + ' - ' + s.name;
        surahSelect.add(opt);
      });
      const last = localStorage.getItem('lastSurah') || '1';
      surahSelect.value = last;
      loadSurah(last);
    }

    // Rating
    function renderRating(surah) {
      ratingDiv.innerHTML = '';
      const saved = localStorage.getItem('rating_' + surah) || 0;
      for (let i = 1; i <= 5; i++) {
        const star = document.createElement('span');
        star.className = 'star' + (i <= saved ? ' active' : '');
        star.textContent = '★';
        star.addEventListener('click', () => {
          localStorage.setItem('rating_' + surah, i);
          renderRating(surah);
        });
        ratingDiv.appendChild(star);
      }
    }

    // Load verses and audio
    async function loadSurah(number) {
      localStorage.setItem('lastSurah', number);
      renderRating(number);
      const res = await fetch(`https://api.alquran.cloud/v1/surah/${number}/ar.alafasy`);
      const data = await res.json();
      versesDiv.innerHTML = '';
      ayahAudios = data.data.ayahs.map(v => v.audio);
      currentAyah = 0;
      data.data.ayahs.forEach(v => {
        const div = document.createElement('div');
        div.className = 'verse';
        div.textContent = v.numberInSurah + '. ' + v.text;
        versesDiv.appendChild(div);
      });
      setupAudio();
      playAyah(currentAyah);
    }

    function playAyah(index) {
      if (index >= ayahAudios.length) return;
      audio.src = ayahAudios[index];
      audio.play();
      playPauseBtn.textContent = '⏸️';
      currentAyah = index;
    }

    audio.onended = () => {
      if (currentAyah + 1 < ayahAudios.length) {
        playAyah(currentAyah + 1);
      } else {
        playPauseBtn.textContent = '▶️';
      }
    };

    function setupAudio() {
      playPauseBtn.textContent = '▶️';
      audio.currentTime = 0;
      audio.addEventListener('timeupdate', () => {
        const pct = (audio.currentTime / audio.duration) * 100;
        progress.style.width = pct + '%';
        timeDisplay.textContent = `${formatTime(audio.currentTime)} / ${formatTime(audio.duration)}`;
      });
    }

    function formatTime(sec) {
      if (isNaN(sec)) return '00:00';
      const m = Math.floor(sec / 60).toString().padStart(2, '0');
      const s = Math.floor(sec % 60).toString().padStart(2, '0');
      return `${m}:${s}`;
    }

    playPauseBtn.addEventListener('click', () => {
      if (audio.paused) {
        audio.play();
        playPauseBtn.textContent = '⏸️';
      } else {
        audio.pause();
        playPauseBtn.textContent = '▶️';
      }
    });

    backwardBtn.addEventListener('click', () => {
      audio.currentTime = Math.max(0, audio.currentTime - 5);
    });

    forwardBtn.addEventListener('click', () => {
      audio.currentTime = Math.min(audio.duration, audio.currentTime + 5);
    });

    progressBar.addEventListener('click', e => {
      const rect = progressBar.getBoundingClientRect();
      const pct = (e.clientX - rect.left) / rect.width;
      audio.currentTime = pct * audio.duration;
    });

    // Init
    loadSurahList();
  </script>
</body>
</html>
