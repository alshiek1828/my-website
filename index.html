<!DOCTYPE html><html lang="ar">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ALS​HIEK الشــيخ - الألعاب والاختبارات (Admin)</title>
  <style>
    /* Reset & Base */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { height: 100%; }
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #1c1c1c; color: #fff; }
    header { background: #222; padding: 10px; display: flex; align-items: center; justify-content: space-between; }
    header h1 { font-size: 1.5em; }
    #admin-section { display: flex; height: calc(100% - 50px); }
    nav#admin-menu { width: 200px; background: #2b2b2b; padding: 10px; }
    nav#admin-menu button { width: 100%; margin:5px 0; background: #444; border:none; color:#fff; padding:8px; cursor:pointer; }
    nav#admin-menu button.active, nav#admin-menu button:hover { background: #ff0066; }
    main#admin-content { flex:1; padding:20px; overflow-y:auto; }
    section.admin-tab { display: none; }
    section.admin-tab.active { display: block; }
    table { width:100%; border-collapse:collapse; margin-top:10px; }
    th, td { border:1px solid #555; padding:8px; text-align:left; }
    .btn-small { padding:5px 10px; font-size:0.9em; }
    input, select, textarea { width:100%; padding:8px; margin:5px 0; background:#333; border:1px solid #555; color:#fff; }
  </style>
</head>
<body>
  <header>
    <h1>لوحة إدارة الموقع</h1>
    <button onclick="logoutAdmin()">تسجيل خروج</button>
  </header>
  <div id="admin-section">
    <nav id="admin-menu">
      <button data-tab="users" class="active">المستخدمين</button>
      <button data-tab="messages">الرسائل</button>
      <button data-tab="maintenance">الصيانة</button>
      <button data-tab="permissions">الصلاحيات</button>
      <button data-tab="scores">نقاط المستخدمين</button>
      <button data-tab="settings">إعدادات</button>
      <button data-tab="logs">السجلات</button>
    </nav>
    <main id="admin-content">
      <!-- Users -->
      <section id="users" class="admin-tab active">
        <h2>إدارة المستخدمين</h2>
        <input type="text" id="search-user" placeholder="ابحث باسم أو ID" />
        <div id="user-list"></div>
      </section>
      <!-- Messages -->
      <section id="messages" class="admin-tab">
        <h2>إرسال رسالة</h2>
        <label>إلى (ID مستخدم)</label><input type="text" id="msg-userid" />
        <label>المحتوى</label><textarea id="msg-content"></textarea>
        <label>عدد مرات الإرسال</label><input type="number" id="msg-count" value="1" min="1" />
        <button id="send-msg" class="btn-small">إرسال</button>
      </section>
      <!-- Maintenance -->
      <section id="maintenance" class="admin-tab">
        <h2>وضع الصيانة</h2>
        <label>نشط؟</label><select id="maintenance-mode"><option value="off">إيقاف</option><option value="on">تشغيل</option></select>
        <label>مدة الصيانة (دقائق)</label><input type="number" id="maintenance-time" />
        <button id="apply-maint" class="btn-small">تطبيق</button>
      </section>
      <!-- Permissions -->
      <section id="permissions" class="admin-tab">
        <h2>إدارة الصلاحيات</h2>
        <label>منح صلاحية أدمن (ID)</label><input type="text" id="grant-userid" />
        <button id="grant-admin" class="btn-small">منح</button>
      </section>
      <!-- Scores -->
      <section id="scores" class="admin-tab">
        <h2>تعديل نقاط المستخدمين</h2>
        <label>User ID</label><input type="text" id="score-userid" />
        <label>النقاط الجديدة</label><input type="number" id="new-score" />
        <button id="update-score" class="btn-small">تحديث</button>
      </section>
      <!-- Settings -->
      <section id="settings" class="admin-tab">
        <h2>إعدادات إضافية</h2>
        <p>هنا يمكنك إضافة المزيد من الإعدادات الزائفة مثل تخصيص واجهة، تغيير الثيمات، ضبط الساعات، ...</p>
      </section>
      <!-- Logs -->
      <section id="logs" class="admin-tab">
        <h2>سجلات النظام</h2>
        <pre id="log-output">لا توجد سجلات بعد.</pre>
      </section>
    </main>
  </div>  <script>
    // Admin UI logic
    document.querySelectorAll('#admin-menu button').forEach(btn=>btn.onclick=e=>{
      document.querySelectorAll('#admin-menu button').forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
      document.querySelectorAll('.admin-tab').forEach(tab=>tab.classList.remove('active'));
      document.getElementById(btn.dataset.tab).classList.add('active');
    });

    // User management
    function loadUsers(filter=''){
      const users = JSON.parse(localStorage.getItem('users')||'{}');
      const container = document.getElementById('user-list'); container.innerHTML='';
      Object.entries(users).forEach(([id,u])=>{
        if(!u.name.includes(filter) && !id.includes(filter)) return;
        let div = document.createElement('div');
        div.style.display='flex'; div.style.justifyContent='space-between'; div.style.padding='5px 0';
        div.innerHTML = \`<span>\${u.name} (\${id})</span>
          <span>\${u.bannedUntil>Date.now()?'محظور':'نشط'}</span>
          <span>
            <button class='btn-small' onclick="banUser('\${id}',60)">حظر 60د</button>
            <button class='btn-small' onclick="unbanUser('\${id}')">فك الحظر</button>
            <button class='btn-small' onclick="removeUser('\${id}')">حذف</button>
          </span>\`;
        container.append(div);
      });
    }
    document.getElementById('search-user').oninput=e=>loadUsers(e.target.value);
    function banUser(id,mins){ const users=JSON.parse(localStorage.getItem('users')); users[id].bannedUntil=Date.now()+mins*60000; localStorage.setItem('users',JSON.stringify(users)); loadUsers(); }
    function unbanUser(id){ const users=JSON.parse(localStorage.getItem('users')); users[id].bannedUntil=0; localStorage.setItem('users',JSON.stringify(users)); loadUsers(); }
    function removeUser(id){ const users=JSON.parse(localStorage.getItem('users')); delete users[id]; localStorage.setItem('users',JSON.stringify(users)); loadUsers(); }
    loadUsers();

    // Messaging
    document.getElementById('send-msg').onclick=()=>{
      const id=document.getElementById('msg-userid').value;
      const cnt=parseInt(document.getElementById('msg-count').value)||1;
      const msg=document.getElementById('msg-content').value;
      for(let i=0;i<cnt;i++){ console.log(`Message to \${id}: \${msg}`); /* 实际 إرسال */ }
      alert('تم إرسال الرسالة');
    };

    // Maintenance
    let maintTimer;
    document.getElementById('apply-maint').onclick=()=>{
      const mode=document.getElementById('maintenance-mode').value;
      const mins=parseInt(document.getElementById('maintenance-time').value)||0;
      localStorage.setItem('siteMaint', mode);
      if(mode==='on'){ setTimeout(()=>{
        localStorage.setItem('siteMaint','off');
      }, mins*60000);
      }
      alert('تم تطبيق وضع الصيانة');
    };
    // On load, redirect if in maintenance
    if(localStorage.getItem('siteMaint')==='on'){ document.body.innerHTML='<h1>الموقع تحت الصيانة</h1><p>سنعود بعد قليل...</p>'; }

    // Permissions
    document.getElementById('grant-admin').onclick=()=>{
      const id=document.getElementById('grant-userid').value;
      const users=JSON.parse(localStorage.getItem('users'));
      if(users[id]) users[id].isAdmin=true;
      localStorage.setItem('users',JSON.stringify(users));
      alert('تم منح صلاحية أدمن لـ ' + id);
    };

    // Scores update
    document.getElementById('update-score').onclick=()=>{
      const id=document.getElementById('score-userid').value;
      const v=parseInt(document.getElementById('new-score').value)||0;
      let lb=JSON.parse(localStorage.getItem('leaderboard')||'{}');
      lb[users[id].name] = v;
      localStorage.setItem('leaderboard',JSON.stringify(lb));
      alert('تم تعديل النقاط');
    };

    // Admin logout
    function logoutAdmin(){ localStorage.removeItem('adminLogged'); location.reload(); }

    // Initial auth for admin
authAdmin();
  </script></body>
</html>
