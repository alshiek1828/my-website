<!DOCTYPE html><html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>سوق إلكتروني</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
  <style>
    body { background-color: #f2f2f2; }
    .navbar-brand { font-weight: bold; font-size: 1.5rem; }
    .product-card { border: none; border-radius: 1rem; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    .product-card img { height: 200px; object-fit: cover; }
    #loginModal .modal-content { border-radius: 1rem; }
    .btn-google { background-color: #db4437; color: #fff; }
    .btn-google:hover { background-color: #c33d2e; }
  </style>
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
    <div class="container">
      <a class="navbar-brand" href="#">سوقنا</a>
      <button class="btn btn-outline-primary ms-auto" data-bs-toggle="modal" data-bs-target="#loginModal" id="authBtn">تسجيل دخول / حساب جديد</button>
    </div>
  </nav>  <div class="container mt-5">
    <div class="row" id="products-list">
      <!-- cards will be injected here -->
    </div><!-- Cart Section -->
<div id="cart-section" class="mt-5" style="display:none;">
  <h3>سلة المشتريات</h3>
  <ul id="cart-items" class="list-group mb-3"></ul>
  <button onclick="checkout()" class="btn btn-success">إتمام الشراء</button>
</div>

  </div>  <!-- Login/Register Modal -->  <div class="modal fade" id="loginModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content p-4">
        <h5 class="modal-title mb-3 text-center">تسجيل / إنشاء حساب</h5>
        <ul class="nav nav-tabs mb-3" id="authTabs" role="tablist">
          <li class="nav-item" role="presentation">
            <button class="nav-link active" id="signIn-tab" data-bs-toggle="tab" data-bs-target="#signIn" type="button">دخول</button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="signUp-tab" data-bs-toggle="tab" data-bs-target="#signUp" type="button">تسجيل</button>
          </li>
        </ul>
        <div class="tab-content" id="authTabsContent">
          <!-- Sign In -->
          <div class="tab-pane fade show active" id="signIn">
            <div class="d-grid gap-2">
              <button class="btn btn-google mb-2" onclick="googleSignIn()">تسجيل بجوجل</button>
            </div>
            <div class="text-center my-2">أو</div>
            <form id="signinForm">
              <input type="email" id="signin-email" class="form-control mb-2" placeholder="البريد الإلكتروني" required>
              <input type="password" id="signin-password" class="form-control mb-3" placeholder="كلمة المرور" required>
              <button type="submit" class="btn btn-primary w-100">دخول</button>
            </form>
            <div id="signInStatus" class="mt-2 text-danger"></div>
          </div>
          <!-- Sign Up -->
          <div class="tab-pane fade" id="signUp">
            <div class="d-grid gap-2">
              <button class="btn btn-google mb-2" onclick="googleSignIn()">إنشاء حساب بجوجل</button>
            </div>
            <div class="text-center my-2">أو</div>
            <form id="signupForm">
              <input type="email" id="signup-email" class="form-control mb-2" placeholder="البريد الإلكتروني" required>
              <input type="password" id="signup-password" class="form-control mb-3" placeholder="كلمة المرور (6 أحرف على الأقل)" required>
              <button type="submit" class="btn btn-success w-100">إنشاء حساب</button>
            </form>
            <div id="signUpStatus" class="mt-2 text-danger"></div>
          </div>
        </div>
      </div>
    </div>
  </div>  <!-- Firebase & Logic -->  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getDatabase, ref, set, onValue, get } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";
    import { getStorage } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDZt1RSz5d9wyn-C5S3kF8XVYjEldtSZss",
      authDomain: "gmae-fae90.firebaseapp.com",
      databaseURL: "https://gmae-fae90-default-rtdb.firebaseio.com",
      projectId: "gmae-fae90",
      storageBucket: "gmae-fae90.appspot.com",
      messagingSenderId: "768482186329",
      appId: "1:768482186329:web:ae3b54ed2aaaf89d4e0d48",
      measurementId: "G-KGQ0RQ33XS"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);
    const storage = getStorage(app);
    const provider = new GoogleAuthProvider();
    let cart = [];

    document.getElementById('signinForm').onsubmit = async e => {
      e.preventDefault();
      const email = document.getElementById('signin-email').value;
      const password = document.getElementById('signin-password').value;
      try {
        await signInWithEmailAndPassword(auth, email, password);
        bootstrap.Modal.getInstance(document.getElementById('loginModal')).hide();
      } catch (e) {
        document.getElementById('signInStatus').innerText = e.message;
      }
    };

    document.getElementById('signupForm').onsubmit = async e => {
      e.preventDefault();
      const email = document.getElementById('signup-email').value;
      const password = document.getElementById('signup-password').value;
      try {
        const uc = await createUserWithEmailAndPassword(auth, email, password);
        await set(ref(db, 'users/' + uc.user.uid), { email, role: 'user' });
        bootstrap.Modal.getInstance(document.getElementById('loginModal')).hide();
      } catch (e) {
        document.getElementById('signUpStatus').innerText = e.message;
      }
    };

    async function googleSignIn() {
      try {
        const res = await signInWithPopup(auth, provider);
        const user = res.user;
        const snap = await get(ref(db, 'users/' + user.uid));
        if (!snap.exists()) await set(ref(db, 'users/' + user.uid), { email: user.email, role: 'user' });
        document.getElementById('signInStatus').innerText = '';
        document.getElementById('signUpStatus').innerText = '';
        bootstrap.Modal.getInstance(document.getElementById('loginModal')).hide();
      } catch (e) {
        document.getElementById('signInStatus').innerText = e.message;
      }
    }

    onAuthStateChanged(auth, user => {
      loadProducts();
      const btn = document.getElementById('authBtn');
      btn.innerText = user ? 'مرحبًا، ' + (user.email || 'ضيف') : 'تسجيل دخول / حساب جديد';
    });

    function loadProducts() {
      onValue(ref(db, 'products'), snap => {
        const list = document.getElementById('products-list');
        list.innerHTML = '';
        snap.forEach(c => {
          const p = c.val();
          const col = document.createElement('div');
          col.className = 'col-md-4 mb-4';
          col.innerHTML = `
            <div class="card product-card">
              <img src="${p.imageUrl}" class="card-img-top">
              <div class="card-body">
                <h5 class="card-title">${p.name}</h5>
                <p class="card-text">السعر: ${p.price} ريال</p>
                <button class="btn btn-primary w-100" onclick='addToCart(${JSON.stringify(p)})'>أضف للسلة</button>
              </div>
            </div>`;
          list.appendChild(col);
        });
      });
    }

    window.addToCart = p => {
      cart.push(p);
      document.getElementById('cart-section').style.display = 'block';
      updateCart();
    };

    function updateCart() {
      const ul = document.getElementById('cart-items');
      ul.innerHTML = '';
      cart.forEach((i, idx) => {
        const li = document.createElement('li');
        li.className = 'list-group-item d-flex justify-content-between';
        li.textContent = `${i.name} - ${i.price} ريال`;
        const btn = document.createElement('button');
        btn.textContent = 'حذف';
        btn.className = 'btn btn-sm btn-danger';
        btn.onclick = () => { cart.splice(idx, 1); updateCart(); };
        li.appendChild(btn);
        ul.appendChild(li);
      });
    }

    window.checkout = () => {
      alert('تم تأكيد الطلب ✅');
      cart = [];
      updateCart();
      document.getElementById('cart-section').style.display = 'none';
    };
  </script>  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script></body>
</html>
