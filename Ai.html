<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AI Chat - Lite</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: sans-serif; margin: 0; background: #f4f4f4; color: #333; }
    .dark body { background: #111; color: #eee; }
    #chat { max-width: 600px; margin: auto; padding: 10px; height: 90vh; overflow-y: scroll; }
    .msg { padding: 10px; margin: 10px; border-radius: 8px; }
    .user { background: #aee; text-align: right; }
    .bot  { background: #ddd; }
    .dark .user { background: #337ab7; }
    .dark .bot { background: #333; }
    #form { position: fixed; bottom: 10px; width: 100%; max-width: 600px; margin: auto; left: 0; right: 0; display: flex; gap: 5px; padding: 0 10px; }
    #input { flex: 1; padding: 10px; border-radius: 5px; border: 1px solid #ccc; }
    #file { display: none; }
    button { padding: 10px; border-radius: 5px; border: none; cursor: pointer; }
    #toggle { position: fixed; top: 10px; right: 10px; }
  </style>
</head>
<body>

<div id="chat"></div>

<form id="form">
  <input id="input" placeholder="Type something..." />
  <button type="button" onclick="startVoice()">ðŸŽ¤</button>
  <button type="submit">Send</button>
  <button type="button" onclick="document.getElementById('file').click()">ðŸ“·</button>
  <input type="file" id="file" accept="image/*" />
</form>

<button id="toggle" onclick="toggleTheme()">ðŸŒ“</button>

<script>
  const chat = document.getElementById('chat');
  const input = document.getElementById('input');
  const file = document.getElementById('file');
  const recognition = window.SpeechRecognition ? new SpeechRecognition() : new webkitSpeechRecognition();

  let history = JSON.parse(localStorage.getItem('chat-history') || '[]');

  const render = () => {
    chat.innerHTML = '';
    history.forEach(m => {
      const div = document.createElement('div');
      div.className = 'msg ' + m.role;
      div.textContent = m.content;
      chat.appendChild(div);
    });
    chat.scrollTop = chat.scrollHeight;
    localStorage.setItem('chat-history', JSON.stringify(history));
  };

  render();

  document.getElementById('form').onsubmit = async (e) => {
    e.preventDefault();
    const msg = input.value.trim();
    if (!msg) return;
    history.push({ role: 'user', content: msg });
    render();
    input.value = '';

    const reply = await fetchAI(history.map(m => m.content).join('\n'));
    history.push({ role: 'bot', content: reply });
    render();
  };

  async function fetchAI(text) {
    const response = await fetch("https://api-inference.huggingface.co/models/gpt2", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ inputs: text })
    });
    const data = await response.json();
    return data[0]?.generated_text?.slice(text.length) || "No reply.";
  }

  function startVoice() {
    recognition.start();
    recognition.onresult = e => input.value = e.results[0][0].transcript;
  }

  function toggleTheme() {
    document.documentElement.classList.toggle('dark');
  }

  file.onchange = () => {
    const imgName = file.files[0]?.name;
    if (imgName) {
      history.push({ role: 'user', content: `[Uploaded image: ${imgName}]` });
      render();
    }
  };
</script>

</body>
</html>
