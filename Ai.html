<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AI Chat - Advanced</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-light: #f9f9f9;
      --bg-dark: #1e1e1e;
      --text-light: #333;
      --text-dark: #eee;
      --accent: #4f46e5;
    }
    body {
      font-family: 'Roboto', sans-serif;
      margin: 0;
      background: var(--bg-light);
      color: var(--text-light);
      transition: all 0.3s ease;
    }
    .dark body {
      background: var(--bg-dark);
      color: var(--text-dark);
    }
    #chat {
      max-width: 800px;
      margin: auto;
      padding: 20px;
      height: 80vh;
      overflow-y: auto;
      border-radius: 12px;
      background: white;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .dark #chat {
      background: #2a2a2a;
    }
    .msg {
      padding: 12px 16px;
      margin: 12px;
      border-radius: 12px;
      max-width: 80%;
      line-height: 1.5;
    }
    .user {
      background: #dbeafe;
      margin-left: auto;
      text-align: right;
    }
    .bot {
      background: #e5e7eb;
      margin-right: auto;
    }
    .dark .user {
      background: #3b82f6;
      color: white;
    }
    .dark .bot {
      background: #444;
    }
    #form {
      position: fixed;
      bottom: 0;
      width: 100%;
      background: white;
      padding: 10px;
      box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
      display: flex;
      justify-content: center;
      gap: 5px;
    }
    .dark #form {
      background: #111;
    }
    #input {
      flex: 1;
      padding: 12px;
      border: 1px solid #ccc;
      border-radius: 8px;
    }
    button {
      padding: 12px;
      background: var(--accent);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    #recording {
      color: red;
      font-weight: bold;
      margin-left: 10px;
      display: none;
      align-self: center;
    }
    #controls { display: flex; gap: 5px; }
    #toggle { position: fixed; top: 10px; right: 10px; cursor: pointer; background: #eee; padding: 6px 10px; border-radius: 6px; }
    .dark #toggle { background: #333; color: white; }
  </style>
</head>
<body><div id="chat"></div><form id="form">
  <input id="input" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ø³Ø§Ù„ØªÙƒ..." />
  <div id="controls">
    <button type="button" onclick="startVoice()">ğŸ¤</button>
    <button type="submit">ğŸ“¨</button>
    <button type="button" onclick="document.getElementById('file').click()">ğŸ“·</button>
    <button type="button" onclick="clearChat()">ğŸ—‘ï¸</button>
  </div>
  <span id="recording">â— ØªØ³Ø¬ÙŠÙ„...</span>
  <input type="file" id="file" accept="image/*" style="display:none" />
</form><button id="toggle" onclick="toggleTheme()">ğŸŒ“ Ø§Ù„ÙˆØ¶Ø¹</button>

<script>
  const chat = document.getElementById('chat');
  const input = document.getElementById('input');
  const file = document.getElementById('file');
  const recordingIndicator = document.getElementById('recording');
  let recognition;
  let history = JSON.parse(localStorage.getItem('chat-history') || '[]');

  if ('SpeechRecognition' in window || 'webkitSpeechRecognition' in window) {
    recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    recognition.lang = 'ar-SA';
  }

  const render = () => {
    chat.innerHTML = '';
    history.forEach(m => {
      const div = document.createElement('div');
      div.className = 'msg ' + m.role;
      div.textContent = m.content;
      chat.appendChild(div);
    });
    chat.scrollTop = chat.scrollHeight;
    localStorage.setItem('chat-history', JSON.stringify(history));
  };

  render();

  document.getElementById('form').onsubmit = async (e) => {
    e.preventDefault();
    const msg = input.value.trim();
    if (!msg) return;
    history.push({ role: 'user', content: msg });
    render();
    input.value = '';

    const reply = await fetchAI(msg);
    history.push({ role: 'bot', content: reply });
    render();
  };

  async function fetchAI(prompt) {
    try {
      const response = await fetch("https://api-inference.huggingface.co/models/google/flan-t5-small", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": "Bearer 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"
        },
        body: JSON.stringify({ inputs: prompt })
      });
      const data = await response.json();
      return data[0]?.generated_text || "ğŸ¤– Ù…Ø§ Ø¹Ù†Ø¯ÙŠ Ø±Ø¯ Ø­Ø§Ù„ÙŠØ§Ù‹.";
    } catch (err) {
      return "âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ API";
    }
  }

  function startVoice() {
    if (!recognition) return alert("ğŸ¤ Ø§Ù„Ù…ÙŠØ²Ø© ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…Ø© ÙÙŠ Ù…ØªØµÙØ­Ùƒ");
    recognition.start();
    recordingIndicator.style.display = 'inline';
    recognition.onresult = e => {
      input.value = e.results[0][0].transcript;
    };
    recognition.onend = () => {
      recordingIndicator.style.display = 'none';
    };
  }

  function toggleTheme() {
    document.documentElement.classList.toggle('dark');
  }

  function clearChat() {
    if (confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù ÙƒÙ„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©ØŸ")) {
      history = [];
      localStorage.removeItem('chat-history');
      render();
    }
  }

  file.onchange = () => {
    const imgName = file.files[0]?.name;
    if (imgName) {
      history.push({ role: 'user', content: `[ğŸ“· ØµÙˆØ±Ø© ØªÙ… Ø±ÙØ¹Ù‡Ø§: ${imgName}]` });
      render();
    }
  };
</script></body>
</html>
